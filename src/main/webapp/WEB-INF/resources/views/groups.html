<script type="text/ng-template" id="createGroupModal.html">    
    <div class="modal-header">
        <h2>Create Group</h2>
    </div>
    <div class="modal-content">
        <form data-ng-submit="createChoreGroup()">
            <div class="input-group">
                <span class="input-group-addon">Name:</span>
                <input data-ng-model="choreGroup.choreGroupName" class="form-control" required>
                <div class="input-group-btn">
                    <button type="submit" class="btn btn-success"><span class="glyphicon glyphicon-arrow-right"></span></button>
                </div>
            </div>

        </form>
    </div>
</script>

<h2>Group Manager</h2>

<div class="row">
    <div class="col-md-3">
        <div class="well">
            <div id="create-group-btn" class="btn btn-success btn-lg" data-ng-click="createGroup()">Create Group <span class="glyphicon glyphicon-plus glyphicon-inline"></span></div>
        </div>        
        <br>
        <div class="well" data-ng-if="currentUserChoreGroupUsers.length > 0">
            <h4>Groups</h4>
            <div class="btn-group-vertical" >
                <div class="btn btn-default" data-ng-class="selected.choreGroupUser === currentUserChoreGroupUser ? 'active' : ''" data-ng-repeat="currentUserChoreGroupUser in currentUserChoreGroupUsers" data-ng-click="selectChoreGroupUser(currentUserChoreGroupUser);">{{currentUserChoreGroupUser.choreGroup.choreGroupName}}</div>            
            </div>
        </div>        
    </div>
    <div class="col-md-9" id="chore-group-manager">
        <div data-ng-show="!selected.choreGroupUser">Select a chore group!</div>
        <div data-ng-show="selected.choreGroupUser" class="panel panel-default">
            <div class="panel-heading">
                <h3><a data-ng-href="/group/{{selected.choreGroupUser.choreGroup.id}}">{{selected.choreGroupUser.choreGroup.choreGroupName}}</a></h3>                
            </div>
            <div class="panel-body">                
                <uib-tabset data-justified="true">
                    <uib-tab data-index="0">                        
                        <uib-tab-heading>
                            <i class="glyphicon glyphicon-user"></i> Members
                        </uib-tab-heading>
                        <br>
                        <form data-ng-submit="sendInvitation(selected.choreGroupUser.choreGroup, recipientEmail)">
                            <div class="input-group">
                                <span class="input-group-addon" id="recipient-email-label">Invite user:</span>
                                <input type="email" class="form-control" data-ng-model="recipientEmail" required placeholder="Email..." aria-describedby="recipient-email-label">
                                <span class="input-group-btn"><button type="submit" class="btn btn-success"><span class=" glyphicon glyphicon-envelope"></span></button></span>
                            </div>
                            <div class="alert alert-danger" data-ng-if="errorMessages.inviteUser">{{errorMessages.inviteUser}}</div>
                            <div data-ng-if="successfulInvite" class="alert alert-success">Invitation sent to {{successfulInvite}}</div>
                        </form>
                        <div id="member-list-wrapper">
                            <div data-ng-if="!selected.choreGroupUser.choreGroup.choreGroupUsers">
                                Loading users...
                            </div>
                            <div data-ng-if="selected.choreGroupUser.choreGroup.choreGroupUsers">
                                <br>
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>User</th><th>Role</th><th>Date Joined</th><th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr data-ng-repeat="choreGroupUser in selected.choreGroupUser.choreGroup.choreGroupUsers">
                                            <td><span class="glyphicon glyphicon-user"></span> {{choreGroupUser.choreUser.email}}</td>
                                            <td>
                                                <select class="form-control" data-ng-change="updateChoreGroupUserRole(selected.choreGroupUser.choreGroup, choreGroupUser)" data-ng-model="choreGroupUser.choreGroupUserRole" data-ng-disabled="choreGroupUser.choreGroupUserRole === 'OWNER' || selected.choreGroupUser.choreGroupUserRole !== 'OWNER'">
                                                    <option value="OWNER">Owner</option>
                                                    <option value="ADMIN">Admin</option>
                                                    <option value="MEMBER">Member</option>
                                                </select>
                                            </td>
                                            <td>
                                                <span data-ng-if="choreGroupUser.status ==='ACCEPTED'">{{choreGroupUser.updated | date: 'short'}}</span>
                                                <span data-ng-if="choreGroupUser.status !=='ACCEPTED'">Invite pending</span>
                                            </td>
                                            <td>
                                                <button class="btn btn-danger" data-ng-disabled="choreGroupUser.choreGroupUserRole === 'OWNER'" data-ng-click="removeChoreGroupUser(selected.choreGroupUser.choreGroup, choreGroupUser)"><span class="glyphicon glyphicon-remove"></span></button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </uib-tab>
                    <uib-tab data-index="1">
                        <uib-tab-heading>
                            <i class="glyphicon glyphicon-wrench"></i> Chores
                        </uib-tab-heading>
                        <button class="btn btn-lg btn-success" data-ng-click="createChore(selecte.choreGroupUser.choreGroup)"><span class="glyphicon glyphicon-plus"></span> Create Chore</button>
                        <table data-ng-if="">
                            <thead>
                                <tr>
                                    <th>Chore</th><th>Frequency</th><th>Preferred Doer</th><th>Next Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr data-ng-repeat="choreSpec in choreGroupUser.choreGroup.choreSpecs">
                                    <td>{{choreSpec.name}}</td>
                                    <td>{{choreSpec.frequency}}</td>
                                    <td>{{choreSpec.preferredDoer.choreUser.email}}</td>
                                    <td>{{choreSpec.nextInstanceDate | date: 'short'}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </uib-tab>
                    <uib-tab data-index="2" data-ng-if="selected.choreGroupUser.choreGroupUserRole === 'OWNER'" data-select="selected.updatedName = selected.choreGroupUser.choreGroup.choreGroupName">
                        <uib-tab-heading>
                            <i class="glyphicon glyphicon-cog"></i> Settings
                        </uib-tab-heading>
                        
                        <br>
                        <div class="row">
                            <form class="col-md-6" data-ng-submit="editChoreGroupName(selected.choreGroupUser.choreGroup)">
                                <div class="input-group">
                                    <div class="input-group-addon">Group Name: </div>
                                    <input class="form-control" data-ng-model="selected.updatedName" data-ng-blur="editChoreGroupName(selected.choreGroupUser.choreGroup)">
                                </div>
                                <div class="alert alert-danger" data-ng-show="errorMessages.editGroupName">{{errorMessages.editGroupName}}</div>
                            </form>

                            <div class="col-md-6">
                                <div id="delete-chore-group-btn-wrapper">
                                    <div class="btn btn-danger btn-lg" data-ng-click="deleteChoreGroup(selected.choreGroupUser.choreGroup)">Delete Group</div>
                                </div>
                            </div>
                        </div>
                    </uib-tab>
                </uib-tabset>                                                    
            </div>            
        </div>        
    </div>
</div>