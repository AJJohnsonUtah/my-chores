<h2>Group Manager</h2>

<div class="row">
    <div class="col-md-3">
        <div class="well">
            <div class="btn btn-success btn-lg" data-ng-click="beginCreatingChoreGroup()">Create Group <span class="glyphicon glyphicon-plus glyphicon-inline"></span></div>
        </div>        
        <br>
        <div class="well" data-ng-if="currentUserChoreGroupUsers.length > 0">
            <h4>Groups</h4>
            <div class="btn-group-vertical" >
                <div class="btn btn-default" data-ng-class="selected.choreGroupUser === currentUserChoreGroupUser ? 'active' : ''" data-ng-repeat="currentUserChoreGroupUser in currentUserChoreGroupUsers" data-ng-click="selectChoreGroupUser(currentUserChoreGroupUser);">{{currentUserChoreGroupUser.choreGroup.choreGroupName}}</div>            
            </div>
        </div>
        
    </div>
    <div class="col-md-9" id="chore-group-manager">
        <div data-ng-show="!selected.choreGroupUser">Select a chore group!</div>
        <div data-ng-show="selected.choreGroupUser" class="panel panel-primary">
            <div class="panel-heading">
                <h3 data-ng-show="!editingName" >{{selected.choreGroupUser.choreGroup.choreGroupName}} <button class="btn btn-default pull-right" data-ng-click="beginEditingChoreGroup()"><span class="glyphicon glyphicon-edit"></span></button></h3>
                <form data-ng-show="editingName" data-ng-submit="editOrCreateChoreGroup(selected.choreGroupUser.choreGroup)">
                    <input id="chore-group-name-textbox" class="form-control input-lg" data-ng-model="selected.updatedName" maxlength="35" required data-ng-blur="editOrCreateChoreGroup(selected.choreGroupUser.choreGroup)" placeholder="Name of group...">
                    <div class="alert alert-danger" data-ng-show="errorMessages.editGroupName">{{errorMessages.editGroupName}}</div>
                </form>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-5">                        
                    </div>
                    <div class="col-md-7">
                        <h4>Group Members</h4>
                        <form data-ng-submit="sendInvitation(selected.choreGroupUser.choreGroup, recipientEmail)">
                            <div class="input-group">
                                <span class="input-group-addon" id="recipient-email-label">Invite user:</span>
                                <input type="email" class="form-control" data-ng-model="recipientEmail" required placeholder="Email..." aria-describedby="recipient-email-label">
                                <span class="input-group-btn"><button type="submit" class="btn btn-success"><span class=" glyphicon glyphicon-envelope"></span></button></span>
                            </div>
                            <div class="alert alert-danger" data-ng-if="errorMessages.inviteUser">{{errorMessages.inviteUser}}</div>
                            <div data-ng-if="successfulInvite" class="alert alert-success">Invitation sent to {{successfulInvite}}</div>
                        </form>
                        <div id="member-list-wrapper">
                            <div data-ng-if="!selected.choreGroupUser.choreGroup.choreGroupUsers">
                                Loading users...
                            </div>
                            <div data-ng-if="selected.choreGroupUser.choreGroup.choreGroupUsers">
                                
                                <h4>Invited Members</h4>
                                <div id="invited-member-list">
                                    <div data-ng-repeat="choreGroupUser in selected.choreGroupUser.choreGroup.choreGroupUsers | filter : isPendingMember">
                                        <div class="input-group">
                                            <span class="input-group-addon">{{choreGroupUser.choreUser.email}}</span>
                                            <select class="form-control" data-ng-change="updateChoreGroupUserRole(selected.choreGroupUser.choreGroup, choreGroupUser)" data-ng-model="choreGroupUser.choreGroupUserRole">
                                                <option value="ADMIN">Admin</option>
                                                <option value="OWNER" data-ng-if="choreGroupUser.choreGroupUserRole === 'OWNER'">Owner</option>
                                                <option value="MEMBER">Member</option>
                                            </select>
                                            <div class="input-group-btn">
                                                <button class="btn btn-danger" data-ng-click="removeChoreGroupUser(selected.choreGroupUser.choreGroup, choreGroupUser)"><span class="glyphicon glyphicon-remove"></span></button>
                                            </div>                                       
                                        </div>
                                    </div>
                                </div>
                                
                                <h4>Active Members</h4>
                                <div id="active-member-list">
                                    <div data-ng-repeat="choreGroupUser in selected.choreGroupUser.choreGroup.choreGroupUsers | filter : isActiveMember">
                                        <div class="input-group">
                                            <span class="input-group-addon">{{choreGroupUser.choreUser.email}}</span>
                                            <select class="form-control" data-ng-change="updateChoreGroupUserRole(selected.choreGroupUser.choreGroup, choreGroupUser)" data-ng-model="choreGroupUser.choreGroupUserRole" data-ng-disabled="choreGroupUser.choreGroupUserRole === 'OWNER'">
                                                <option value="OWNER">Owner</option>
                                                <option value="ADMIN">Admin</option>
                                                <option value="MEMBER">Member</option>
                                            </select>
                                            <div class="input-group-btn">
                                                <button class="btn btn-danger" data-ng-disabled="choreGroupUser.choreGroupUserRole === 'OWNER'" data-ng-click="removeChoreGroupUser(selected.choreGroupUser.choreGroup, choreGroupUser)"><span class="glyphicon glyphicon-remove"></span></button>
                                            </div>                                       
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" data-ng-if="selected.choreGroupUser.choreGroupUserRole === 'OWNER'">
                    <hr>
                    <div class="col-md-12">
                        <div id="delete-chore-group-btn-wrapper">
                            <div class="btn btn-danger btn-lg" data-ng-click="deleteChoreGroup(selected.choreGroupUser.choreGroup)">Delete Group</div>
                        </div>
                    </div>
                </div>
            </div>            
        </div>        
    </div>
</div>